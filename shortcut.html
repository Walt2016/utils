<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .test {
            width: 100px;
            height: 100px;
            border: 1px solid #000;
        }

        .test[active] {
            background: #ccc
        }

        .inputbox {
            width: 100px;
            height: 40px;
            border: 1px solid #000;
        }
    </style>
</head>

<body>
    <script src="utils.js"></script>
    <script>
        var _box = function () {
            var box = _.divInput("", {
                "class": "inputbox"
            }, {
                next: function () {
                    _box();
                }
            })
            _.append(document.body, box)
        }
        _box()

        var len = 10
        for (var i = 0; i < len; i++) {
            var test = _.div("", {
                "class": "test"
            }, {
                click: function (e) {
                    var el = e.target
                    _.toggle(el, "active")
                }
            })
            _.append(document.body, test)
        }

// _.event(document,{
//     click:function(e){
//         console.log(document.activeElement)
//     }
// })




       

        var inputbox = _.query(".inputbox")
        _.shortcut([document], { //, document
            enter: function (e) {
                var target = e.target;
                console.log(e.target)
                console.log(e.events)
                console.log(document.activeElement)
                // if (target == inputbox) {
                //     var evt = _.event(inputbox)
                //     console.log(evt)
                //     evt.fire("next")

                //     e.preventDefault();
                //     e.stopPropagation();
                //     return false;

                //     //   


                // } else {

                //     var el = _.query("[active]") || _.query(".test")
                //     _.toggle(el, "active")
                // }

            },
            leftarrow: function (e) {
                console.log(e)
                console.log(e.target)
            }
        })

        // _.shortcut
    </script>

    <script>
        // $.fn.AndKey = function (options) {
        //     "use strict"
        //     var _options = {
        //         bindKey: "",
        //         model: "once", //once loop
        //         interval: 50,
        //         context: this,
        //         callBack: function () {}
        //     };
        //     $.extend(_options, options);

        //     var bindKeyArr = (_options.bindKey).split("+");

        //     $(this).attr("tabindex", 0).focus();

        //     var keyStatus = {};
        //     var keyForm = {
        //         "A": 65,
        //         "B": 66,
        //         "C": 67,
        //         "D": 68,
        //         "E": 69,
        //         "F": 70,
        //         "G": 71,
        //         "H": 72,
        //         "I": 73,
        //         "J": 74,
        //         "K": 75,
        //         "L": 76,
        //         "M": 77,
        //         "N": 78,
        //         "O": 79,
        //         "p": 80,
        //         "Q": 81,
        //         "R": 82,
        //         "S": 83,
        //         "T": 84,
        //         "U": 85,
        //         "V": 86,
        //         "W": 87,
        //         "X": 88,
        //         "Y": 69,
        //         "Z": 90,
        //         "0": 48,
        //         "1": 49,
        //         "2": 50,
        //         "3": 51,
        //         "4": 52,
        //         "5": 53,
        //         "6": 54,
        //         "7": 55,
        //         "8": 56,
        //         "9": 57,
        //         //数字键盘按键 加R开头
        //         "R0": 96,
        //         "R1": 97,
        //         "R2": 98,
        //         "R3": 99,
        //         "R4": 100,
        //         "R5": 101,
        //         "R6": 102,
        //         "R7": 103,
        //         "R8": 104,
        //         "R9": 105,
        //         "R*": 106,
        //         "R+": 107,
        //         "Renter": 108,
        //         "R-": 109,
        //         "R.": 110,
        //         "R/": 111,
        //         //键盘
        //         "enter": 13,
        //         "shift": 16,
        //         "ctrl": 17,
        //         "alt": 18,
        //         "leftArrow": 37,
        //         "upArrow": 38,
        //         "rightArrow": 39,
        //         "downArrow": 40
        //     };
        //     var setListen; //定时
        //     if (bindKeyArr.length) {
        //         for (var index in keyForm) {
        //             for (var i = 0; i < bindKeyArr.length; i++) {
        //                 if (bindKeyArr[i] == index) {
        //                     keyStatus[keyForm[index]] = {
        //                         status: false,
        //                         key: bindKeyArr[i]
        //                     };
        //                     break;
        //                 }
        //             }
        //         }
        //     }
        //     var Flag = true;

        //     function setListenFun() {
        //         if (Flag) {
        //             Flag = false;
        //             setListen = setInterval(function () {
        //                 for (var item in keyStatus) {
        //                     if (!keyStatus[item]["status"]) {
        //                         return;
        //                     }
        //                 }
        //                 if (_options.model == "loop") {
        //                     //TODO
        //                 } else if (_options.model == "once") {
        //                     clearInterval(setListen);
        //                 }
        //                 _options.callBack.apply(_options.context || this);
        //             }, _options.interval);
        //         }
        //     }
        //     $(this).on("keyup", function (e) {
        //         clearInterval(setListen);
        //         Flag = true;
        //         keyStatus.hasOwnProperty(e.keyCode) && (keyStatus[e.keyCode]["status"] = false);
        //     });
        //     $(this).on("keydown", function (e) {
        //         setListenFun();
        //         keyStatus.hasOwnProperty(e.keyCode) && (keyStatus[e.keyCode]["status"] = true);
        //     });

        // }
    </script>
    <script>
        ;
        (function () {

            var keyCodeMap = {
                '.': 'shortcutLoadItems',
                '/': 'shortcutSearchItems',
                '?': 'shortcutShowHelp',
                'j': 'shortcutNextItem',
                'k': 'shortcutPrevItem',
                'n': 'shortcutNewItem',
                'o': 'shortcutOpenItem',
            };

            var eventBlacklist = {
                'input': true,
                'textarea': true,
                'select': true
            };

            document.addEventListener('keypress', function (e) {
                var tagName = document.activeElement.tagName.toLowerCase();
                var shortcut = keyCodeMap[String.fromCharCode(e.charCode)];
                var shortcutEvent;

                if (typeof shortcut === undefined || eventBlacklist[tagName]) {
                    return;
                }

                if (window.CustomEvent) {
                    shortcutEvent = new CustomEvent(shortcut);
                } else {
                    shortcutEvent = document.createEvent('CustomEvent');
                    shortcutEvent.initCustomEvent(shortcut, false, false, null);
                }

                document.dispatchEvent(shortcutEvent);
            });

        })();
    </script>

    <script>
    /**
 * http://www.openjs.com/scripts/events/keyboard_shortcuts/
 * Version : 2.01.B
 * By Binny V A
 * License : BSD
 */
// shortcut = {
// 	'all_shortcuts':{},//All the shortcuts are stored in this array
// 	'add': function(shortcut_combination,callback,opt) {
// 		//Provide a set of default options
// 		var default_options = {
// 			'type':'keydown',
// 			'propagate':false,
// 			'disable_in_input':false,
// 			'target':document,
// 			'keycode':false
// 		}
// 		if(!opt) opt = default_options;
// 		else {
// 			for(var dfo in default_options) {
// 				if(typeof opt[dfo] == 'undefined') opt[dfo] = default_options[dfo];
// 			}
// 		}
// 		var ele = opt.target;
// 		if(typeof opt.target == 'string') ele = document.getElementById(opt.target);
// 		var ths = this;
// 		shortcut_combination = shortcut_combination.toLowerCase();
// 		//The function to be called at keypress
// 		var func = function(e) {
// 			e = e || window.event;
			
// 			if(opt['disable_in_input']) { //Don't enable shortcut keys in Input, Textarea fields
// 				var element;
// 				if(e.target) element=e.target;
// 				else if(e.srcElement) element=e.srcElement;
// 				if(element.nodeType==3) element=element.parentNode;
// 				if(element.tagName == 'INPUT' || element.tagName == 'TEXTAREA') return;
// 			}
	
// 			//Find Which key is pressed
// 			if (e.keyCode) code = e.keyCode;
// 			else if (e.which) code = e.which;
// 			var character = String.fromCharCode(code).toLowerCase();
			
// 			if(code == 188) character=","; //If the user presses , when the type is onkeydown
// 			if(code == 190) character="."; //If the user presses , when the type is onkeydown
// 			var keys = shortcut_combination.split("+");
// 			//Key Pressed - counts the number of valid keypresses - if it is same as the number of keys, the shortcut function is invoked
// 			var kp = 0;
			
// 			//Work around for stupid Shift key bug created by using lowercase - as a result the shift+num combination was broken
// 			var shift_nums = {
// 				"`":"~",
// 				"1":"!",
// 				"2":"@",
// 				"3":"#",
// 				"4":"$",
// 				"5":"%",
// 				"6":"^",
// 				"7":"&",
// 				"8":"*",
// 				"9":"(",
// 				"0":")",
// 				"-":"_",
// 				"=":"+",
// 				";":":",
// 				"'":"/"",
// 				",":"<",
// 				".":">",
// 				"/":"?",
// 				"//":"|"
// 			}
// 			//Special Keys - and their codes
// 			var special_keys = {
// 				'esc':27,
// 				'escape':27,
// 				'tab':9,
// 				'space':32,
// 				'return':13,
// 				'enter':13,
// 				'backspace':8,
	
// 				'scrolllock':145,
// 				'scroll_lock':145,
// 				'scroll':145,
// 				'capslock':20,
// 				'caps_lock':20,
// 				'caps':20,
// 				'numlock':144,
// 				'num_lock':144,
// 				'num':144,
				
// 				'pause':19,
// 				'break':19,
				
// 				'insert':45,
// 				'home':36,
// 				'delete':46,
// 				'end':35,
				
// 				'pageup':33,
// 				'page_up':33,
// 				'pu':33,
	
// 				'pagedown':34,
// 				'page_down':34,
// 				'pd':34,
	
// 				'left':37,
// 				'up':38,
// 				'right':39,
// 				'down':40,
	
// 				'f1':112,
// 				'f2':113,
// 				'f3':114,
// 				'f4':115,
// 				'f5':116,
// 				'f6':117,
// 				'f7':118,
// 				'f8':119,
// 				'f9':120,
// 				'f10':121,
// 				'f11':122,
// 				'f12':123
// 			}
	
// 			var modifiers = { 
// 				shift: { wanted:false, pressed:false},
// 				ctrl : { wanted:false, pressed:false},
// 				alt  : { wanted:false, pressed:false},
// 				meta : { wanted:false, pressed:false}	//Meta is Mac specific
// 			};
                        
// 			if(e.ctrlKey)	modifiers.ctrl.pressed = true;
// 			if(e.shiftKey)	modifiers.shift.pressed = true;
// 			if(e.altKey)	modifiers.alt.pressed = true;
// 			if(e.metaKey)   modifiers.meta.pressed = true;
                        
// 			for(var i=0; k=keys[i],i<keys.length; i++) {
// 				//Modifiers
// 				if(k == 'ctrl' || k == 'control') {
// 					kp++;
// 					modifiers.ctrl.wanted = true;
// 				} else if(k == 'shift') {
// 					kp++;
// 					modifiers.shift.wanted = true;
// 				} else if(k == 'alt') {
// 					kp++;
// 					modifiers.alt.wanted = true;
// 				} else if(k == 'meta') {
// 					kp++;
// 					modifiers.meta.wanted = true;
// 				} else if(k.length > 1) { //If it is a special key
// 					if(special_keys[k] == code) kp++;
					
// 				} else if(opt['keycode']) {
// 					if(opt['keycode'] == code) kp++;
// 				} else { //The special keys did not match
// 					if(character == k) kp++;
// 					else {
// 						if(shift_nums[character] && e.shiftKey) { //Stupid Shift key bug created by using lowercase
// 							character = shift_nums[character]; 
// 							if(character == k) kp++;
// 						}
// 					}
// 				}
// 			}
			
// 			if(kp == keys.length && 
// 						modifiers.ctrl.pressed == modifiers.ctrl.wanted &&
// 						modifiers.shift.pressed == modifiers.shift.wanted &&
// 						modifiers.alt.pressed == modifiers.alt.wanted &&
// 						modifiers.meta.pressed == modifiers.meta.wanted) {
// 				callback(e);
	
// 				if(!opt['propagate']) { //Stop the event
// 					//e.cancelBubble is supported by IE - this will kill the bubbling process.
// 					e.cancelBubble = true;
// 					e.returnValue = false;
	
// 					//e.stopPropagation works in Firefox.
// 					if (e.stopPropagation) {
// 						e.stopPropagation();
// 						e.preventDefault();
// 					}
// 					return false;
// 				}
// 			}
// 		}
// 		this.all_shortcuts[shortcut_combination] = {
// 			'callback':func, 
// 			'target':ele, 
// 			'event': opt['type']
// 		};
// 		//Attach the function with the event
// 		if(ele.addEventListener) ele.addEventListener(opt['type'], func, false);
// 		else if(ele.attachEvent) ele.attachEvent('on'+opt['type'], func);
// 		else ele['on'+opt['type']] = func;
// 	},
// 	//Remove the shortcut - just specify the shortcut and I will remove the binding
// 	'remove':function(shortcut_combination) {
// 		shortcut_combination = shortcut_combination.toLowerCase();
// 		var binding = this.all_shortcuts[shortcut_combination];
// 		delete(this.all_shortcuts[shortcut_combination])
// 		if(!binding) return;
// 		var type = binding['event'];
// 		var ele = binding['target'];
// 		var callback = binding['callback'];
// 		if(ele.detachEvent) ele.detachEvent('on'+type, callback);
// 		else if(ele.removeEventListener) ele.removeEventListener(type, callback, false);
// 		else ele['on'+type] = false;
// 	}
// }
</script>
</body>

</html>